# -*- coding: utf-8 -*-
"""
Created on Wed Sep 28 11:39:00 2022

@author: drj
"""
import pandapower as pp
import pandapower.networks as nw
import pandapower.plotting as pplt
import matplotlib.pyplot as plt
# Step 1 Optimization Energy Networks

net = nw.create_cigre_network_mv()

net
vmax = 1.05
vmin = 0.95
max_ll = 100

lines = net.line.index 
N = list()

for l in lines:
    net.line.loc[l,"in_service"] = False
    pp.runpp(net)
    
    if net.res_bus.vm_pu.max() > vmax or net.res_bus.vm_pu.min() < vmin or net.res_line.loading_percent.max() > max_ll:
        N.append(l)
    net.line.loc[l,"in_service"] = True
    
ax = pplt.simple_plot(net, show_plot = False)
clc = pplt.create_line_collection(net, N, color ="r", linewidth = 3.,use_bus_geodata=(True))
pplt.draw_collections([clc], ax=ax)
plt.show()
